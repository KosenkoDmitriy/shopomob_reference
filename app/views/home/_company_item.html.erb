<style>
    .map_container{
        position: relative;
        width: 100%;
        padding-bottom: 56.25%; /* Ratio 16:9 ( 100%/16*9 = 56.25% ) */
    }
    .map_container .map_canvas{
        position: absolute;
        top: 0;
        right: 0;
        bottom: 0;
        left: 0;
        margin: 0;
        padding: 0;
        background-color: #CCC;
    }

</style>
<!--<script src="https://maps.googleapis.com/maps/api/js"></script>-->
<%#= javascript_include_tag "home/google.map", "data-no-turbolink" => true %>
<%#= javascript_include_tag "application", "data-no-turbolink" => true %>

<!--<script src="http://maps.google.com/maps/api/js?v=3.13&sensor=false&libraries=geometry" type="text/javascript"></script>-->
<!--<script src='http://google-maps-utility-library-v3.googlecode.com/svn/tags/markerclustererplus/2.0.14/src/markerclusterer_packed.js' type='text/javascript'></script>-->

<script type="text/javascript" charset="utf-8">

//    Gmaps.map = new Gmaps4RailsGoogle();
//    Gmaps.load_map = function() {
//        Gmaps.map.map_options.auto_adjust = true;
//        Gmaps.map.initialize();
//        Gmaps.map.markers = [{"lng": "4.481594", "lat": "51.194179"}];
//        Gmaps.map.markers_conf.do_clustering = true;
//        Gmaps.map.create_markers();
//        Gmaps.map.adjustMapToBounds();
//        Gmaps.map.callback();
//    };
//    window.onload = function() { Gmaps.loadMaps(); };
//
//    handler = Gmaps.build('Google');
//handler.offsetWidth = 100;
//handler.offsetHeight = 100;
//
//    handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
//        markers = handler.addMarkers([
//            {
//                "lat": 43.0167,
//                "lng":  44.6500,
//                "picture": {
//                    "url": "https://addons.cdn.mozilla.net/img/uploads/addon_icons/13/13028-64.png",
//                    "width":  36,
//                    "height": 36
//                },
//                "infowindow": "hello!"
//            }
//        ]);
//        handler.bounds.extendWith(markers);
//        handler.fitMapToBounds();
//    });

    //    handler = Gmaps.build('Google');
    //    handler.buildMap({ provider: {}, internal: {id: 'map'}}, function(){
    //
    //    });

    //
</script>

<script>

var ready;
ready = function() {
    console.log("ready");

    var geocoder;
    var map;
    function initialize() {
        var map_canvas = document.getElementById('map_canvas');
        var map_options = {
            center: new google.maps.LatLng(43.0167, 44.6500),
            zoom: 16,
            mapTypeId: google.maps.MapTypeId.ROADMAP
        }
        map = new google.maps.Map(map_canvas, map_options)
        geocoder = new google.maps.Geocoder();

        codeAddress();
    }

    function codeAddress() {
//        var element = document.getElementById("address").firstChild;
//        address = element.textContent || element.innerText || "";
        var address = $("#address").attr('value');
        console.log(address);

        geocoder.geocode( { 'address': address}, function(results, status) {
            if (status == google.maps.GeocoderStatus.OK) {
                map.setCenter(results[0].geometry.location);
                var marker = new google.maps.Marker({
                    map: map,
                    position: results[0].geometry.location
                });
            } else {
                alert("Geocode was not successful for the following reason: " + status);
            }
        });
    }



    google.maps.event.addDomListener(window, 'load', initialize);

};

$(document).ready(ready);
$(document).on('page:load', ready);
//$(document).on('page:change', ready);

//function loadScript() {
//    var script = document.createElement('script');
//    script.type = 'text/javascript';
//    script.src = 'https://maps.googleapis.com/maps/api/js?' +
//            'callback=initialize';
//    document.body.appendChild(script);
//}
//window.onload = loadScript;

</script>

<% if (@shop) %>
    <header><h2><%= @shop.name %></h2></header>
    <p>
      <%#= image_tag( (@shop.try(:images).try(:first).try(:image_url).blank?) ? "#{root_url}assets/missing.png" : @shop.images.first.image_url, :class => "img-circle", :width => "100%") %>
      <%= (!@shop.try(:images).try(:first).try(:image_url).blank?) ? image_tag( (@shop.try(:images).try(:first).try(:image).try(:image_url)), :class => "img-circle", :width => "100%") : image_tag( 'missing.png', :class => "img-circle", :width => "100%" ) %>
      <!--<img class="img-thumbnail" src="assets/home/b2458.png">ShopoMob-->
    </p>
    <p>
      <!--<img class="img-thumbnail" src="<%=root_url%>assets/home/b2458.png">-->
      <% @shop.try(:images).each do |image| %>
          <%#= image_tag (image.try(:image_url)) if (image != nil )  %>
      <% end %>

    </p>
    <p><%=@shop.try(:time_work) %></p>
    <!--Avtozapchasti-->
    <!--ulitsa Iristonskaya, 74-->
    <!--Vladikavkaz, Северная Осетия-Алания республика-->
    <!--362000-->
    <!--74, Иристонская, Владикавказ, Северная Осетия-Алания Республика, 362000-->
    <p id="address" value="<%=@shop.try(:address)%>, <%=t("default_address.city")%>" >
      <%=@shop.try(:postal) %> <%=@shop.try(:address) %>
    </p>


    <p><%=@shop.try(:www) %></p>
    <% @shop.try(:contact_items).each do |contact| %>
        <p><%= contact.value %></p>
    <% end %>
    <p><%= @shop.try(:description) %></p>

    <div class="map_container">
      <div id="map_canvas" class="map_canvas">

      </div>
    </div>
    <!--map2-->
    <!--<div style='width: 800px;'>-->
      <!--<div id="map" style='width: 800px; height: 400px; background-color: #ccc'></div>-->
    <!--</div>-->

    <%#= link_to @shop.name, controller: "home", action: "shops", id: @shop %>
<% else %>
    <p><%= t("no_shop_selected")%></p>
<% end %>

